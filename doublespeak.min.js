function Doublespeak(){this.encVals=Object.freeze({'\u200C':0,'\u200D':1,'\u2060':2,'\u2061':3,'\u2062':4,'\u2063':5,'\u2064':6,'\u206A':7,'\u206B':8,'\u206C':9,'\u206D':10,'\u206E':11,'\u206F':12,'\uFE00':13,'\uFE01':14,'\uFEFF':15}),this.encChars=Object.freeze(Object.keys(this.encVals)),this.encodeLength=function(a){let b=[127&a];for(;127<a;)a>>=7,b.unshift(128|127&a);return Uint8Array.from(b)},this.decodeLength=function(a){let b=0;for(var d=0;d<a.length;d++)b=b<<7|127&a[d];return b},this.encodeBytes=function(...a){const b=this.encChars;let d='';for(var e of a){e instanceof Uint8Array||(e=Uint8Array.from(e));for(var f=0,g=e.length;f<g;f++)d+=b[e[f]>>4]+b[15&e[f]]}return d},this.decodeBytes=function(a){const b=this.encVals;let d=[],e=[];for(var h,f=0,g=a.length;f<g;)if(h=b[a[f++]],void 0!==h){let l=[];do l.push(h),h=b[a[f++]];while(void 0!==h);if(16>l.length)continue;1&l.length&&l.pop(),d=d.concat(l),e.push(l.length>>1)}let j=[];for(var f=0,k=d.length;f<k;f+=2)j.push(d[f]<<4|d[f+1]);return{bytes:Uint8Array.from(j),seqLens:e}},this.filterStr=function(a){const b=this.encVals;let d='';for(var e=0,f=a.length;e<f;)if(b[a[e]]===void 0)d+=a[e++];else{let g=a[e];for(;b[a[++e]]!==void 0;)g+=a[e];16>g.length&&(d+=g)}return d},this.encodeText=function(a){const b=new TextEncoder().encode(this.filterStr(a)),d=b.length?this.encodeBytes([68,0],this.crc32(b),[1],this.encodeLength(b.length),b):'';return console.info('Original size:',b.length,'bytes,',a.length,'characters','\nEncoded size:',3*d.length,'bytes,',d.length,'characters'),d},this.encodeFile=function(a,b,d){const e=new TextEncoder().encode(a+'\0'+b+'\0');let f=new Uint8Array(e.length+d.length);f.set(e),f.set(d,e.length);const g=this.encodeBytes([68,0],this.crc32(f),[2],this.encodeLength(f.length),f);return console.info('File:',b+',',a||'unknown','\nOriginal size:',d.length,'bytes','\nEncoded size:',3*g.length,'bytes,',g.length,' characters'),g},this.extractText=function(a){return new TextDecoder().decode(a)},this.extractFile=function(a){let b=[];for(var d=0,e=a.length;d<e&&!(!a[d]&&(b.push(d),1<b.length));d++);const f=new TextDecoder().decode(a.subarray(0,b[0])),g=new TextDecoder().decode(a.subarray(b[0]+1,b[1])),h=new Blob([a.subarray(b[1]+1)],{type:f}),j=URL.createObjectURL(h),k=h.size;return{type:f,name:g,url:j,size:k}},this.decodeData=function(a){let{bytes:b,seqLens:d}=this.decodeBytes(a),e=[];do{if(!b.length||68!=b[0]&&0!=b[1]){if(!b.length)e.push({error:'No message detected'});else{e.push({error:'Protocol mismatch',details:'\nData: '+new TextDecoder().decode(b.subarray(d[0]))}),b=b.subarray(d.shift());continue}break}let f=0;for(;128&b[6+ ++f];);const g=7+f,h=b.subarray(2,g),j=h[4],k=g+this.decodeLength(h.subarray(5)),l=b.subarray(g,k);console.info('Original size:',l.length,'bytes','\nEncoded size:',6*k,'bytes,',2*k,'characters');const m=this.crc32(l).every((o,p)=>o===h[p]);e.push({crcMatch:m,dataType:j,data:l}),m&&(k<d[0]?d[0]-=k:d.shift()),b=b.subarray(m?k:d.shift())}while(b.length);return e},this.crcTable=(()=>{let a=[],b;for(var d=0;256>d;d++){b=d;for(var e=0;8>e;e++)b=1&b?3988292384^b>>>1:b>>>1;a[d]=b}return a})(),this.crc32=function(a){const b=this.crcTable;let d=-1;for(var e=0,f=a.length;e<f;e++)d=d>>>8^b[255&(d^a[e])];for(d=(-1^d)>>>0,console.info('CRC-32: 0x'+('0000000'+d.toString(16)).slice(-8)),a=[],e=24;0<=e;e-=8)a.push(255&d>>e);return Uint8Array.from(a)}}